## 04. 팩토리 패턴 : 불필요한 의존성을 없애서 결합 문제를 해결하자

#### new 연산자가 눈에 띈다면 '구상'이라는 용어를 떠올려 주세요.

new를 사용하면 구상클래스의 인스턴스가 만들어진다. 당연히 인터페이스가 아닌 특정 구현을 사용하는 것이다. 앞에서 구상 클래스를 바탕으로 코딩하면 나중에 코드를 수정해야 할 가능성이 커지고, 유연성이 떨어진다.

일련의 구상 클래스가 있다면 어쩔 수 없이 다음과 같은 코드를 만들어야 한다.

```java

Duck duck;
if (picnic) {
    duck = new MallardDuck();
} else if (hunting) {
    duck = new DecoyDuck();
} else if (inBathTub) {
    duck = new RubberDuck();
}
```


위와 같은 코드를 변경하거나 확장해야 할 때는 코드를 다시 확인하고 새로운 코드를 추가하거나 기존 코드를 제거해야 한다. 따라서 코드를 이런식으로 만들면 관리와 갱신이 어려워지고 오류가 생길 가능성도 커진다.


#### new에 어떤 문제가 있는 것인가?

새로운 구상형식을 써서 확장 해야할 때는 어떻게 해서든 다시 열 수 있게 만들어야 한다.

1. 어떤 코드가 바뀌고 바뀌지 않는 부분을 정의한다.
2. 객체 생성 부분을 캡슐화 한다.
3. 이제 객체 생성 부분을 분리하고, 새로 만들 객체를 팩토리라 정의한다.
4. 그렇게 되면, 기존에 객체를 생성하는 메서드는 클라이언트가 되고 새롭게 객체를 생성하는 부분은 서버라 생각하면 쉽다.
5. 마지막으로 Factory의 레퍼런스를 과거에 객체를 생성했던 클래스에 레퍼런스를 저장하고 생성자를 만들어서 팩토리의 객체를 저장하면 된다!

#### 이렇게 장점이 있을까?

피자 객체 생성 작업을 팩토리 클래스로 캡슐화 해놓으면 구현을 변경할 때 여기저기 고칠 필요 없이 팩토리 클래스 하나만 고치면 된다. 그러고 조금 있으면 클라이언트 코드에서 구상 클래스의 인스턴스를 만드는 코드를 전부 없애면 된다.

#### 정적 팩토리 메서드는 무엇인가?

간단한 팩토리를 정적 메소드로 선언한 것이다. 정적 메소드를 쓰면 객체 생성 메소드를 실행하려고 객체의 인스턴스를 만들지 않아도 되기 때문이다. 하지만, 서브클래스를 만들어서 객체 생성 메소드의 행동을 변경할 수 없다는 단점도 있다.

___

### 피자가게 프레임워크 만들기

피자를 만드는 일 자체는 전부 PizzaStore 클래스에서 진행하면서 지점의 스타일을 살릴 수 있는 방법이 있다.
이제 createPizza() 메소드를 PizzaStore에 다시 넣고, 하지만 이번에는 그 메소드를 추상 메소드로 선언하고, 지역별 스타일에 맞게 PizzaStore의 서브클래스를 만든다.

```java

public abstract class PizzaStore {

    public Pizza orderPizza(String type) {
        Pizza pizza;

        pizza = createPizza(type);

        pizza.prepare();
        pizza.bake();
        pizza.cut();
        pizza.box();

        return pizza;
    }

    abstract Pizza createPizza(String type); // 팩토리 객체 대신 이 메소드를 사용한다.
}
```

### 팩토리 메서드 선언하기

PizzaStore를 계속 고친 결과, 구상 클래스 인스턴스 만드는 일을 하나의 객체가 전부 처리하는 방식에서 일련의 서브 클래스가 처리하는 방ㅅ식으로 바뀌었다.

```java

public abstract class PizzaStore {
    public Pizza orderPizza(String type) {
        Pizza pizza;

        pizza = createPizza(type);

        pizza.prepare();
        pizza.bake();
        pizza.cut();
        pizza.box();

        return pizza;
    }

    protected abstract Pizza createPizza(String type);
    // Pizza 인스턴스를 맏느는일은 팩토리 메서드에서 맡아서 처리
}
```

팩토리 메서드는 객체 생성을 서브클래스에서 캡슐화할 수 있다. 그러면 슈퍼클래스에 있는 클라이언트 코드와 서브클래스에 있는 객체 생성 코드를 분리할 수 있다.

### 팩터리 메서드 패턴 살펴보기

모든 팩토리 패턴은 객체 생성을 캡슐화 한다. 팩토리 메서드 패턴은 서브클래스에서 어떤 클래스를 만들지 결정함으로써 객체 생성을 캡슐화 한다.
즉, 생산자(Creator)와 제품(Product)를 분리하면 된다.

팩토리 메소드 패턴을 사용하면 여러번 재사용이 가능한 프레임워크를 만들 수 있다.

### 의존성 뒤집기 원칙

`추상화된 것에 의존하게 만들고 구상 클래스에 의존하지 않게 만든다. `
너무 멋있는 문구이다.
